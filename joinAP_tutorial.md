# åŸºäºå¤šè¯­è¨€/è·¨è¯­è¨€ASR(JoinAP)
**æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨JoinAPæ¨¡å‹è¿›è¡Œå¤šè¯­è¨€/è·¨è¯­è¨€ASRçš„ç ”ç©¶ï¼Œå¼€å§‹å‰æ¨èå…ˆé˜…è¯»ä»¥ä¸‹å‚è€ƒèµ„æ–™äº†è§£ç†è®ºçŸ¥è¯†ä»¥åŠç›¸å…³ç»†èŠ‚**
- Chengrui Zhu, Keyu An, Huahuan Zheng and Zhijian Ou, "Multilingual and crosslingual speech recognition using phonological-vector based phone embeddings", IEEE Workshop on Automatic Speech Recognition and Understanding (ASRU), 2021. [pdf](http://oa.ee.tsinghua.edu.cn/~ouzhijian/pdf/ASRU21_JoinAP.pdf)

**æœ¬æ–‡æ¡£å°†ç»†åŒ–è¯´æ˜å®éªŒçš„æ¯ä¸€æ­¥è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®è·å–ï¼Œæ•°æ®é¢„å¤„ç†ï¼Œå‘éŸ³è¯å…¸çš„ç”Ÿæˆ(G2P),éŸ³ä½çŸ¢é‡ç”Ÿæˆï¼Œæ¨¡å‹è®­ç»ƒè¯„ä¼°ç­‰ã€‚**

* [æ•°æ®è·å–åŠé¢„å¤„ç†](#æ•°æ®è·å–åŠé¢„å¤„ç†)

* [å‘éŸ³è¯å…¸](#å‘éŸ³è¯å…¸)

* [éŸ³ä½çŸ¢é‡](#éŸ³ä½çŸ¢é‡)

* [è®­ç»ƒåŠè¯„ä¼°](#è®­ç»ƒåŠè¯„ä¼°)

## æ•°æ®è·å–åŠé¢„å¤„ç†

æœ¬æ¬¡å®éªŒæ•°æ®é€‰æ‹©å¼€æºCommon Voice[æ•°æ®](https://commonvoice.mozilla.org/zh-CN/datasets)ä½œä¸ºåŸå§‹è®­ç»ƒè¯­æ–™ï¼Œé’ˆå¯¹CommonVoiceCorpus5.1ä¸­å¾·è¯­(750å°æ—¶)ï¼Œæ³•è¯­(604å°æ—¶)ï¼Œè¥¿ç­ç‰™è¯­(521å°æ—¶)ï¼Œæ„å¤§åˆ©è¯­(167å°æ—¶)ï¼Œæ³¢å…°è¯­(119å°æ—¶)è¿›è¡Œå¤šè¯­è¨€ä»¥åŠè·¨è¯­è¨€çš„å®éªŒï¼›è¿™äº›å¼€æºæ•°æ®å¯ä»¥ç›´æ¥ä¸‹è½½å¾—åˆ°ã€‚ä¸‹è½½å¥½çš„æ•°æ®ç”±éŸ³é¢‘åŠè®­ç»ƒï¼ŒéªŒè¯ï¼Œæµ‹è¯•æ–‡æœ¬æ„æˆã€‚

æ•°æ®é¢„å¤„ç†é˜¶æ®µä»¿ç…§kaldiè„šæœ¬å¤„ç†[CAT-commonvoice](https://github.com/thu-spmi/CAT/tree/master/egs/commonvoice),å…¶ä¸­ **local**ä¸‹çš„è„šæœ¬æ–‡ä»¶æ— éœ€ä»»ä½•æ”¹åŠ¨åªéœ€è¦ä¿®æ”¹**run_mc.sh** è„šæœ¬æ–‡ä»¶å³å¯ã€‚è„šæœ¬ä¸­**stage7**å¼€å§‹ä¸ºjoinAPæ¨¡å‹çš„è®­ç»ƒéƒ¨åˆ†ï¼Œæˆ‘ä»¬ç›®å‰åªè¯´æ˜æ•°æ®å¤„ç†å‰6éƒ¨åˆ†ã€‚

```
lang=(de it fr es)
datadir=/path/to/cv-corpus-5.1-2020-06-22/

saved_dict="saved_dict"
dict_tmp=data/local/dict_tmp
 
```
**lang**å†³å®šè®­ç»ƒçš„è¯­è¨€ç§ç±»de(å¾·è¯­)ï¼Œit(æ„å¤§åˆ©è¯­)ï¼Œfr(æ³•è¯­)ï¼Œes(è¥¿ç­ç‰™è¯­)å¯ä»¥æ ¹æ®è‡ªå·±ç¡¬ä»¶è¦æ±‚åŠç›®çš„è¿›è¡Œå®éªŒã€‚**datadir**å­˜æ”¾æˆ‘ä»¬è®­ç»ƒçš„æ•°æ®ç›®å½•

**saved_dict**å­˜æ”¾è®­ç»ƒçš„å®Œæ•´å‘éŸ³è¯å…¸**dict_tmp**å­˜æ”¾ä»æ–‡æœ¬æ•°æ®ä¸­åˆ‡åˆ†ä¸‹çš„æœªæ³¨éŸ³çš„è¯å…¸(æ³¨éŸ³éƒ¨åˆ†åç»­ä¼šå¯¹å…¶è¯´æ˜)

```
if [ $stage -le 1 ] && [ $stop_stage -ge 1 ]; then

```
è¿™éƒ¨åˆ†ä»£ç ä»¿ç…§kaldiå¤„ç†ï¼Œä¸»è¦ç”Ÿæˆ**train,dev,test**ä¸‹çš„**wav.scp,text,utt2spk,spk2utt**æ–‡ä»¶


```

if [ $stage -le 2 ] && [ $stop_stage -ge 2 ]; then

```
è¿™éƒ¨åˆ†ä¸»è¦æ˜¯é’ˆå¯¹Multilingualè®­ç»ƒè¯å…¸è¿›è¡ŒåŠ å™ªå¹¶æ’åºå¹¶ç”¨æ•°å­—ç¼–å·çš„å£°å­¦å•å…ƒunits.txtä»¥åŠç”¨æ•°å­—æ ‡å·çš„è¯å…¸lexicon_numbers.txtã€‚ä»¥åŠç”Ÿæˆå¾·è¯­ï¼Œæ³•è¯­ï¼Œè¥¿ç­ç‰™ä»¥åŠæ„å¤§åˆ©è¯­çš„TLG.fstã€‚


```

if [ $stage -le 3 ] && [ $stop_stage -ge 3 ]; then

```
è¿™ä¸€éƒ¨åˆ†åˆ©ç”¨FBankè¿›è¡Œç‰¹å¾æå–å’Œç‰¹å¾å½’ä¸€åŒ–ç”±äºJoinAPæ¨¡å‹åŸºäºVGGBLSTMç³»åˆ—æ¨¡å‹æ‰€ä»¥æˆ‘ä»¬`conf`ç›®å½•ä¸‹fbank.confè®¾ç½®16Kå’Œ40ç»´è¿›è¡Œæå–ä¸”åŒæ—¶é»˜è®¤ä½¿ç”¨ä¸‰å€æ•°æ®å¢å¹¿ã€‚


```

if [ $stage -le 4 ] && [ $stop_stage -ge 4 ]; then

```
è¿™éƒ¨åˆ†ä¸»è¦æ˜¯å°†å•è¯åºåˆ—è½¬æ¢ä¸ºæ ‡ç­¾åºåˆ—


```

if [ $stage -le 5 ] && [ $stop_stage -ge 5 ]; then

```
è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬å°†è®­ç»ƒä»¥åŠæµ‹è¯•æ•°æ®åŠ ä¸€é˜¶å’ŒäºŒé˜¶å·®åˆ†ä»¥ä¾¿äºæ¨¡å‹è®­ç»ƒ


```
if [ $stage -le 6 ] && [ $stop_stage -ge 6 ]; then

```
ç”Ÿæˆden_lm.fstã€‚æœ€åç”±den_lm.fstå’Œæ ‡ç­¾æ–‡ä»¶å‡ºå‘ï¼Œè®¡ç®—å‡ºæ ‡ç­¾åºåˆ—$l$çš„å¯¹æ•°æ¦‚ç‡ $logp(l)ï¼Œç§°ä¸ºpath weightåŒæ—¶æ•´åˆåˆ°data/pickleä¸‹ã€‚

## å‘éŸ³è¯å…¸

ç”±äºCommon Voiceæ•°æ®æ²¡æœ‰æä¾›ç›¸åº”çš„è¯å…¸ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±æ‰‹åŠ¨ç”Ÿæˆã€‚è¿™é‡Œåœ¨**stage1**æ­¥éª¤ä¸­æœ‰å¦‚ä¸‹ä¸€æ¡awk+sedå‘½ä»¤ï¼š

`cat data/${train_set}/text | awk '{$1="";print $0}' | sed 's/ /\n/g' | sort -u >$dict_tmp/wordlist_${x}` è¿™ä¸€å‘½ä»¤è„šæœ¬åœ¨data/local/dict_tmpç›®å½•ä¸­ç”Ÿæˆde,fr,es,itæ²¡æœ‰æ³¨éŸ³çš„è¯å…¸(wordlist_de,wordlist_it,wordlist_es,wordlist_fr),æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ©ç”¨G2På·¥å…·å»å°†æœªæ³¨éŸ³çš„è¯å…¸å»è¿›è¡Œæ³¨éŸ³ã€‚

**ä»¥ä¸‹è¯´æ˜G2Pçš„å®‰è£…ä»¥åŠä½¿ç”¨**

**Phonetisaurus G2P**

**å®‰è£…**ï¼š[G2P](https://github.com/AdolfVonKleist/Phonetisaurus)

åˆ›å»ºä¸€ä¸ªç›®å½•ç”¨äºG2Pçš„å®‰è£…
```
$ mkdir g2p
$ cd g2p/
```

ä¸‹è½½å¹¶å®‰è£… OpenFst-1.7.2
```
$ wget http://www.openfst.org/twiki/pub/FST/FstDownload/openfst-1.7.2.tar.gz
$ tar -xvzf openfst-1.7.2.tar.gz
$ cd openfst-1.7.2
$ ./configure --enable-static --enable-shared --enable-far --enable-ngram-fsts
$ make -j
$ sudo make install
$ echo 'export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/lib:/usr/local/lib/fst' \
     >> ~/.bashrc
$ source ~/.bashrc
$ cd ..
```

ä»æœ€æ–°github-master gitä¸‹æœ€æ–°çš„Phonetisaurus å¹¶ä½¿ç”¨ python3 ç»‘å®šè¿›è¡Œç¼–è¯‘ï¼š
```
$ git clone https://github.com/AdolfVonKleist/Phonetisaurus.git
$ cd Phonetisaurus
$ sudo pip3 install pybindgen
$ PYTHON=python3 ./configure --enable-python
$ make
$ sudo make install
$ cd python
$ cp ../.libs/Phonetisaurus.so .
$ sudo python3 setup.py install
$ cd ../..
```

è·å–å¹¶å®‰è£… mitlm 
```
$ git clone https://github.com/mitlm/mitlm.git
$ cd mitlm/
$ ./autogen.sh
$ make
$ sudo make install
$ cd ..
```

è·å–æœ€æ–°ç‰ˆæœ¬ CMUdict çš„å‰¯æœ¬å¹¶æ¸…ç†ä¸€ä¸‹ï¼š
```
$ mkdir example
$ cd example
$ wget https://raw.githubusercontent.com/cmusphinx/cmudict/master/cmudict.dict
$ cat cmudict.dict \
  | perl -pe 's/\([0-9]+\)//;
              s/\s+/ /g; s/^\s+//;
              s/\s+$//; @_ = split (/\s+/);
              $w = shift (@_);
              $_ = $w."\t".join (" ", @_)."\n";' \
  > cmudict.formatted.dict
```

ä½¿ç”¨åŒ…è£…çš„è„šæœ¬è®­ç»ƒå…·æœ‰é»˜è®¤å‚æ•°çš„å®Œæ•´æ¨¡å‹ã€‚æ³¨æ„ï¼šé»˜è®¤ python3 ç»‘å®šç¼–è¯‘ï¼š
```
$ phonetisaurus-train --lexicon cmudict.formatted.dict --seq2_del
```

**è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†G2På·¥å…·å®‰è£…**

æµ‹è¯•ï¼š(test.wlistæ˜¯æœªæ³¨éŸ³çš„è¯å…¸)

```
$ phonetisaurus-apply --model train/model.fst --word_list test.wlist
```
test  t ËˆÉ› s t

jumbotron   dÊ’ ËˆÊŒ m b É™ÊŠ t É» É’ n

excellent  É™ k s É™ l É™ n t

amazing  Ã¦ m ËˆeÉª z Éª Å‹

**å®‰è£…å¥½åçš„G2Péœ€è¦è®­ç»ƒå¥½çš„fstå„ç±»è¯­è¨€çš„æ¨¡å‹å¯¹å¾·è¯­ï¼Œæ³•è¯­ï¼Œè¥¿ç­ç‰™ï¼Œæ„å¤§åˆ©è¯­è¿›è¡Œæ³¨éŸ³**

**LanguageNet Grapheme-to-Phoneme Transducers**ï¼š[FST](https://github.com/uiuc-sst/g2ps)

gitä¸‹å·²ç»è®­ç»ƒå¥½çš„FSTå¹¶æµ‹è¯•
```
$ git clone https://github.com/uiuc-sst/g2ps
$ phonetisaurus-g2pfst --model=g2ps/models/akan.fst --word=ahyiakwa
```

**æ³¨æ„**ï¼šmodelsä¸‹çš„fstæ–‡ä»¶éœ€è¦è§£å‹

**è¿è¡Œä»¥ä¸‹è„šæœ¬å‘½ä»¤å¯ä»¥ç”Ÿæˆæ¯ç§è¯­è¨€å‘éŸ³è¯å…¸**

```
g2ps=/mnt/workspace/liziwei/g2ps/models/ # g2p model çš„è·¯å¾„
dict_tmp=/mnt/workspace/liziwei/data/local/dict_tmp/ # å­˜æ”¾æœªæ³¨éŸ³åŠæ³¨éŸ³å®Œæˆåå­˜æ”¾ç›®å½•
    phonetisaurus-apply --model $g2ps/french_8_4_2.fst --word_list $dict_tmp/wordlist_fr > $dict_tmp/lexicon_fr
    phonetisaurus-apply --model $g2ps/german_8_4_2.fst --word_list $dict_tmp/wordlist_de > $dict_tmp/lexicon_de
    phonetisaurus-apply --model $g2ps/spanish_4_3_2.fst --word_list $dict_tmp/wordlist_es > $dict_tmp/lexicon_es
    phonetisaurus-apply --model $g2ps/italian_8_2_3.fst --word_list $dict_tmp/wordlist_it > $dict_tmp/lexicon_it
```
**dict_tmpç›®å½•ä¸‹å·²ç»ç”Ÿæˆæˆ‘ä»¬æ‰€éœ€è¦çš„å‘éŸ³è¯å…¸**

## éŸ³ä½çŸ¢é‡

åœ¨å¤šè¯­è¨€å£°å­¦æ¨¡å‹è®­ç»ƒæ—¶æˆ‘ä»¬å¸Œæœ›èƒ½ç”¨ä¸€ä¸ªçŸ¢é‡è¡¨ç¤ºæ¯ä¸ªéŸ³ç´ å¹¶ä¸”è¿™ä¸ªçŸ¢é‡åŒ…å«éŸ³ç´ çš„å‘éŸ³ä¿¡æ¯ï¼Œç”±æ­¤å¼•å…¥éŸ³ä½çŸ¢é‡å¯¹æ¨¡å‹æœ€åè¾“å‡ºçº¿æ€§å±‚è¿›è¡Œä¿®æ”¹ã€‚éŸ³ä½çŸ¢é‡çš„å½¢æˆç”¨åˆ°äº†panphonå·¥å…·åŒ…ï¼›panphonå®šä¹‰äº†å…¨éƒ¨ IPA éŸ³ç´ ç¬¦å·åˆ°åŒºåˆ«ç‰¹å¾çš„æ˜ å°„ï¼›è¿™æ ·å¯ä»¥ç›´æ¥æ ¹æ® IPA éŸ³ç´ å¾—åˆ°å®ƒçš„åŒºåˆ«ç‰¹å¾è¡¨è¾¾ã€‚

**panphonå·¥å…·åŒ…**[panphon](https://github.com/dmort27/panphon)

æˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªéŸ³ç´ è¿›è¡Œæ‰‹åŠ¨æ ‡è®°ï¼Œpanphonä¸€å…±æä¾›24ä¸ªåŒºåˆ«ç‰¹å¾ï¼Œæ¯ç§ç‰¹å¾åˆè¢«ç”¨â€œ+â€ã€â€œ-â€ã€â€œ0â€ä¸‰ç§ç¬¦å·è¡¨ç¤ºï¼Œç”±æ­¤æˆ‘ä»¬å°†**å…¶ä¸­â€œ+â€è¢«ç¼–ç â€œ10â€â€œ-â€è¢«ç¼–ç ä¸ºâ€œ01â€ï¼Œâ€œ00â€åˆ™è¡¨ç¤ºâ€œ0â€ç¬¦å·**ã€‚è¿™æ ·ä¸€æ¥24 ç»´çš„åŒºåˆ«ç‰¹å¾è¢«ç¼–ç ä¸ºäº† 48 ç»´çš„éŸ³ä½çŸ¢é‡ã€‚å†åŠ ä¸Šä¸‰ä¸ªç‰¹æ®Š tokenï¼šblkï¼ˆç©ºï¼‰ã€spnï¼ˆè¯´è¯å™ªéŸ³ï¼‰ã€nsnï¼ˆè‡ªç„¶å™ªéŸ³ï¼‰ä¸€å…±51ç»´éŸ³ä½çŸ¢é‡ã€‚

**æ³¨æ„**ï¼šæ˜ å°„è¡¨ä¸­æœªå‡ºç°çš„éŸ³ç´ æˆ‘ä»¬ç§°ä¹‹ä¸ºé›†å¤–éŸ³ç´ ï¼›å¯¹äºä½œä¸ºåˆ†éš”ç¬¦å·æˆ–åœé¡¿è¯­æ°”ç­‰å¯¹è®­ç»ƒæ— å½±å“çš„éŸ³ç´ å¯ä»¥ç›´æ¥å…¨éƒ¨æ ‡è®°ä¸º0ï¼›å…¶å®ƒé›†å¤–éŸ³ç´ å°†å…¶æ˜ å°„åˆ°ä¸å…¶å®ƒå£°å­¦ä¸Šæœ€ç›¸ä¼¼çš„éŸ³ç´ ã€‚

**éŸ³ç´ æ˜ å°„å…³ç³»è¡¨**[IPA](https://github.com/dmort27/panphon/blob/master/panphon/data/ipa_all.csv)

æˆ‘ä»¬å¯ä»¥é€šè¿‡æ˜ å°„è¡¨å°†æ¯ä¸ªéŸ³ç´ è¿›è¡Œç¼–ç  `ä»¥ä¸‹å±•ç¤ºä»¥å¾·è¯­ä¸ºä¾‹`

|    |   token | IPA   |   syl+ |   syl- |   son+ |   son- |   cons+ |   cons- |   cont+ |   cont- |   delrel+ |   delrel- |   lat+ |   lat- |   nas+ |   nas- |   srtid+ |   strid- |   voi+ |   voi- |   sg+ |   sg- |   cg+ |   cg- |   ant+ |   ant- |   cor+ |   cor- |   distr+ |   distr- |   lab+ |   lab- |   hi+ |   hi- |   lo+ |   lo- |   back+ |   back- |   round+ |   round- |   velaric+ |   velaric- |   tense+ |   tense- |   long+ |   long- |   hitone+ |   hitone- |   hireg+ |   hireg- |   blk |   nsn |   spn |
|---:|--------:|:------|-------:|-------:|-------:|-------:|--------:|--------:|--------:|--------:|----------:|----------:|-------:|-------:|-------:|-------:|---------:|---------:|-------:|-------:|------:|------:|------:|------:|-------:|-------:|-------:|-------:|---------:|---------:|-------:|-------:|------:|------:|------:|------:|--------:|--------:|---------:|---------:|-----------:|-----------:|---------:|---------:|--------:|--------:|----------:|----------:|---------:|---------:|------:|------:|------:|
|  0 |       1 | blk |      0 |      0 |      0 |      0 |       0 |       0 |       0 |       0 |         0 |         0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |       0 |       0 |        0 |        0 |          0 |          0 |        0 |        0 |       0 |       0 |         0 |         0 |        0 |        0 |     1 |     0 |     0 |
|  1 |       2 | NSN |      0 |      0 |      0 |      0 |       0 |       0 |       0 |       0 |         0 |         0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |       0 |       0 |        0 |        0 |          0 |          0 |        0 |        0 |       0 |       0 |         0 |         0 |        0 |        0 |     0 |     1 |     0 |
|  2 |       3 | SPN |      0 |      0 |      0 |      0 |       0 |       0 |       0 |       0 |         0 |         0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |       0 |       0 |        0 |        0 |          0 |          0 |        0 |        0 |       0 |       0 |         0 |         0 |        0 |        0 |     0 |     0 |     1 |
|  3 |       4 | #     |      0 |      0 |      0 |      0 |       0 |       0 |       0 |       0 |         0 |         0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |       0 |       0 |        0 |        0 |          0 |          0 |        0 |        0 |       0 |       0 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
|  4 |       5 | 1     |      0 |      0 |      0 |      0 |       0 |       0 |       0 |       0 |         0 |         0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |       0 |       0 |        0 |        0 |          0 |          0 |        0 |        0 |       0 |       0 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
|  5 |       6 | 7     |      0 |      0 |      0 |      0 |       0 |       0 |       0 |       0 |         0 |         0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |      0 |      0 |      0 |      0 |        0 |        0 |      0 |      0 |     0 |     0 |     0 |     0 |       0 |       0 |        0 |        0 |          0 |          0 |        0 |        0 |       0 |       0 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
|  6 |       7 | a     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     1 |     0 |       0 |       1 |        0 |        1 |          0 |          1 |        1 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
|  7 |       8 | b     |      0 |      1 |      0 |      1 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      1 |      0 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
|  8 |       9 | d     |      0 |      1 |      0 |      1 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      1 |      0 |      1 |      0 |        0 |        1 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
|  9 |      10 | e     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        1 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 10 |      11 | f     |      0 |      1 |      0 |      1 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        1 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      1 |      0 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 11 |      12 | g     |      0 |      1 |      0 |      1 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       1 |       0 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 12 |      13 | h     |      0 |      1 |      1 |      0 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 13 |      14 | i     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        1 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 14 |      15 | j     |      0 |      1 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 15 |      16 | k     |      0 |      1 |      0 |      1 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       1 |       0 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 16 |      17 | l     |      0 |      1 |      1 |      0 |       1 |       0 |       1 |       0 |         0 |         1 |      1 |      0 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      1 |      0 |      1 |      0 |        0 |        1 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 17 |      18 | m     |      0 |      1 |      1 |      0 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      1 |      0 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      1 |      0 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 18 |      19 | n     |      0 |      1 |      1 |      0 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      1 |      0 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      1 |      0 |      1 |      0 |        0 |        1 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 19 |      20 | o     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       1 |       0 |        1 |        0 |          0 |          1 |        1 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 20 |      21 | p     |      0 |      1 |      0 |      1 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      1 |      0 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 21 |      22 | r     |      0 |      1 |      1 |      0 |       1 |       0 |       1 |       0 |         0 |         0 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      1 |      0 |      1 |      0 |        0 |        1 |      0 |      1 |     0 |     0 |     0 |     0 |       0 |       0 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 22 |      23 | s     |      0 |      1 |      0 |      1 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        1 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      1 |      0 |      1 |      0 |        0 |        1 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 23 |      24 | t     |      0 |      1 |      0 |      1 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      1 |      0 |      1 |      0 |        0 |        1 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 24 |      25 | ts    |      0 |      1 |      0 |      1 |       1 |       0 |       0 |       1 |         1 |         0 |      0 |      1 |      0 |      1 |        1 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      1 |      0 |      1 |      0 |        0 |        1 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 25 |      26 | u     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      1 |      0 |     1 |     0 |     0 |     1 |       1 |       0 |        1 |        0 |          0 |          1 |        1 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 26 |      27 | v     |      0 |      1 |      0 |      1 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        1 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      1 |      0 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 27 |      28 | w     |      0 |      1 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     1 |     0 |     0 |     1 |       1 |       0 |        1 |        0 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 28 |      29 | y     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      1 |      0 |     1 |     0 |     0 |     1 |       0 |       1 |        1 |        0 |          0 |          1 |        1 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 29 |      30 | z     |      0 |      1 |      0 |      1 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        1 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      1 |      0 |      1 |      0 |        0 |        1 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 30 |      31 | Ã§     |      0 |      1 |      0 |      1 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 31 |      32 | Ã¸     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        1 |        0 |          0 |          1 |        1 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 32 |      33 | Å‹     |      0 |      1 |      1 |      0 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      1 |      0 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       1 |       0 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 33 |      34 | Å“     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        1 |        0 |          0 |          1 |        0 |        1 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 34 |      35 | É”     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       1 |       0 |        1 |        0 |          0 |          1 |        0 |        1 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 35 |      36 | É›     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        1 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 36 |      37 | É¡     |      0 |      1 |      0 |      1 |       1 |       0 |       0 |       1 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       1 |       0 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 37 |      38 | Éª     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        1 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 38 |      39 | Ê     |      0 |      1 |      0 |      1 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      1 |      0 |      1 |        0 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       1 |       0 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 39 |      40 | Êƒ     |      0 |      1 |      0 |      1 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        1 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |      0 |      1 |      1 |      0 |        1 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 40 |      41 | ÊŠ     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       1 |       0 |        1 |        0 |          0 |          1 |        0 |        1 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 41 |      42 | Ê     |      1 |      0 |      1 |      0 |       0 |       1 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        0 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      0 |      0 |      1 |        0 |        0 |      0 |      1 |     1 |     0 |     0 |     1 |       0 |       1 |        1 |        0 |          0 |          1 |        0 |        1 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |
| 42 |      43 | Ê’     |      0 |      1 |      0 |      1 |       1 |       0 |       1 |       0 |         0 |         1 |      0 |      1 |      0 |      1 |        1 |        0 |      1 |      0 |     0 |     1 |     0 |     1 |      0 |      1 |      1 |      0 |        1 |        0 |      0 |      1 |     0 |     1 |     0 |     1 |       0 |       1 |        0 |        1 |          0 |          1 |        0 |        0 |       0 |       1 |         0 |         0 |        0 |        0 |     0 |     0 |     0 |


**æ‰‹åŠ¨ç¼–ç å®Œæˆåè¿˜éœ€å°†å…¶è½¬æ¢æˆ`numpy`æ ¼å¼æ–‡ä»¶ä»¥ä¾¿äºæ¨¡å‹è®­ç»ƒ**

```
$ pip install numpy
$ import numpy as np
$ np.save('de.npy',path)

```

ä½¿ç”¨numpyè¯»å–éŸ³ä½çŸ¢é‡ï¼š
```
$import numpy as np
$de=np.load('de.npy')
$de

array( [[0, 0, 0, ..., 1, 0, 0],

     [0, 0, 0, ..., 0, 1, 0],
     
     [0, 0, 0, ..., 0, 0, 1],
           ...,
     [1, 0, 1, ..., 0, 0, 0],
       
     [1, 0, 1, ..., 0, 0, 0],
     
     [0, 1, 0, ..., 0, 0, 0]], dtype=int64)
```

**è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†éŸ³ä½çŸ¢é‡çš„æ„å»º**

## è®­ç»ƒåŠè¯„ä¼°

è®­ç»ƒåŠè¯„ä¼°éƒ¨åˆ†å…·ä½“å¯ä»¥å‚è€ƒ[CAT-JoinAP](https://github.com/thu-spmi/CAT/blob/master/joinap.md)å®˜æ–¹è¯´æ˜ï¼Œè¿™é‡Œæˆ‘ä»¬åªå¯¹**JoinAP-Linear**ä½œä¸ºæ¼”ç¤º

**è®­ç»ƒéƒ¨åˆ†ä»£ç **

```
PARENTDIR='.'
dir="exp/mc_linear/"
DATAPATH=$PARENTDIR/data/
mkdir -p $dir

if [ $stage -le 7 ] && [ $stop_stage -ge 7 ]; then
    unset CUDA_VISIBLE_DEVICES
    
    if [[ $NODE == 0 && ! -f $dir/scripts.tar.gz ]]; then
        echo ""
        tar -zcf $dir/scripts.tar.gz $(readlink ctc-crf) $0
    elif [ $NODE == 0 ]; then
        echo ""
        echo "'$dir/scripts.tar.gz' already exists."
        echo "If you want to update it, please manually rm it then re-run this script."
    fi

  # uncomment the following line if you want to use specified GPUs
    CUDA_VISIBLE_DEVICES=0,1,2,3,4                    \
    python3 ctc-crf/train.py --seed=0               \
        --world-size 1 --rank $NODE                 \
        --mc-train-pv=./embedding/mul.npy            \
        --batch_size=128                            \
        --dir=$dir                                  \
        --config=$dir/config.json         \
        --trset=data/pickle/train.pickle            \
        --devset=data/pickle/dev.pickle             \
        --data=$DATAPATH                            \
        || exit 1
fi

```
è®­ç»ƒçš„è¿™éƒ¨å’Œå•è¯­ç§è®­ç»ƒç›¸åŒå”¯ä¸€åŒºåˆ«æ·»åŠ äº†`--mc-train-pv`è¿™ä¸ªå‚æ•°ï¼ŒæŒ‡å®šè·¯å¾„ä¸ºæˆ‘ä»¬èµ·å§‹æ„å»ºçš„å¤šè¯­ç§çš„éŸ³ä½çŸ¢é‡`numpy`æ–‡ä»¶ã€‚


**Finetuneéƒ¨åˆ†ä»£ç **


```
finetune_dir="exp/mc_linear_finetune_de/"
if [ $stage -le 8 ] && [ $stop_stage -ge 8 ]; then
    # finetune
    unset CUDA_VISIBLE_DEVICES
    
    if [[ $NODE == 0 && ! -f $dir/scripts.tar.gz ]]; then
        echo ""
        tar -zcf $dir/scripts.tar.gz $(readlink ctc-crf) $0
    elif [ $NODE == 0 ]; then
        echo ""
        echo "'$dir/scripts.tar.gz' already exists."
        echo "If you want to update it, please manually rm it then re-run this script."
    fi

    CUDA_VISIBLE_DEVICES=0,1,2,3,4                    \
    python3 ctc-crf/train.py --seed=0               \
        --world-size 1 --rank $NODE                 \
        --batch_size=128                            \
	--grad-accum-fold=2                           \
        --mc-train-pv=./embedding/mul.npy            \
        --resume=$dir/ckpt/bestckpt.pt              \
        --den-lm=data/den_meta_de/den_lm.fst        \
        --mc-conf=./conf/mc_linear_finetune_de.json    \
        --trset=data/pickle/train_de.pickle         \
        --devset=data/pickle/dev_de.pickle          \
        --dir=$finetune_dir                         \
        --config=$dir/config.json                   \
        --data=data/train_de || exit 1;
fi

```
Finrtuneè¿™éƒ¨åˆ†æ˜¯å¯¹ç›®æ ‡è¯­è¨€(de,fr,es,it)è¿›è¡Œå¾®è°ƒå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸è¿›è¡Œå¾®è°ƒç›´æ¥tesingä½†æˆ‘ä»¬é€šè¿‡å¤§é‡å®éªŒå·²è¯æ˜ç»è¿‡å¾®è°ƒåçš„ç›®æ ‡è¯­è¨€å‡†ç¡®æ€§ä¼šæ›´å¥½ã€‚

`--grad-accum-fold` æ¢¯åº¦ç´¯åŠ (é»˜è®¤ä¸º1)å˜å‘å¢åŠ batch_sizeã€‚

`mc-conf` confç›®å½•ä¸‹jsonæ–‡ä»¶ç›¸å…³å‚æ•°é…ç½®ï¼š

```
{
    "src_token": "./data/lang_phn/tokens.txt",
    "des_token": "./data/lang_phn_de/tokens.txt",
    "P": "./embedding/de.npy",
    "hdim": 640,
    "odim": 43, 
    "lr": 1e-5,
    "mode": "joinap_linear",
    "usg": "finetune"
}

```
`src_token`ï¼šåŸå§‹æ¨¡å‹å•å…ƒ
 
`des_token`: è®­ç»ƒç›®æ ‡è¯­è¨€å•å…ƒ

`P`: finetuneç›®æ ‡è¯­è¨€éŸ³ä½çŸ¢é‡
 
`lr`: æ¨¡å‹å¾®è°ƒæ—¶å€™å­¦ä¹ ç‡

`hdim`ï¼šéšå«å±‚ç»´åº¦

`odim`ï¼šç›®æ ‡è¯­è¨€çš„éŸ³ç´ é›†æ•°é‡

`mode`: ä¸‰ç§æ¨¡å‹ç±»å‹ `["flat_phone", "joinap_linear", "joinap_nonlinear"]`

`usg`: `["fientune", "zero-shot-eval", "few-shot-eval", "multi-eval", "multi-finetune-eval"]`ï¼›Finetuneé˜¶æ®µæˆ‘ä»¬é»˜è®¤é€‰æ‹©`finetune` å³å¯ 


**æµ‹è¯•éƒ¨åˆ†ä»£ç **


```
nj=20

if [ $stage -le 9 ] && [ $stop_stage -ge 9 ]; then
    for lang in de; do
        scp=data/all_ark/test_${lang}.scp
        ark_dir=$finetune_dir/decode_${lang}_test_bd_tgpr/logits
        mkdir -p $ark_dir
        CUDA_VISIBLE_DEVICES=0,3            \
        python3 ctc-crf/calculate_logits.py                 \
            --mc-conf=./conf/mc_linear_finetune_de_eval.json                   \
            --mc-train-pv=./embedding/de.npy            \
            --resume=$finetune_dir/ckpt/bestckpt.pt                     \
            --config=$finetune_dir/config.json                       \
            --nj=$nj --input_scp=$scp                       \
            --output_dir=$ark_dir                           \
            || exit 1
        
        ctc-crf/decode.sh  --stage 1 --cmd "$decode_cmd" --nj $nj --acwt 1.0 data/lang_phn_${lang}_test_bd_tgpr \
            data/test_${lang} data/all_ark/test_${lang}.ark $finetune_dir/decode_${lang}_test_bd_tgpr || exit 1
    done
fi
```
**æ³¨æ„**ï¼šè¿™æ—¶`mc-train-pv`è¦æŒ‡å®šæˆ‘ä»¬ç›®æ ‡è¯­è¨€(de,es,fr,it)çš„éŸ³ä½çŸ¢é‡

`--mc-conf` confç›®å½•ä¸‹jsonæ–‡ä»¶ç›¸å…³å‚æ•°é…ç½®ï¼š

```
{
    "src_token": "./data/lang_phn/tokens.txt",
    "des_token": "./data/lang_phn_de/tokens.txt",
    "P": "./embedding/de.npy",
    "hdim": 640,
    "odim": 43,
    "lr": 1e-5,
    "mode": "joinap_linear",
    "usg": "multi-finetune-eval"
}
```
ä¸Finetuneé˜¶æ®µä¸åŒçš„æ˜¯`usg`éœ€è¦ä¿®æ”¹ï¼š

`multi-finetune-eval` ç»è¿‡Finetuneåå¤šè¯­è¨€(de,fr,es,it)æµ‹è¯•è¯„ä¼°

`multi-eval` æ²¡æœ‰ç»è¿‡Finetuneå¤šè¯­è¨€(de,fr,es,it)æµ‹è¯•è¯„ä¼°

`few-shot-eval` ç»è¿‡Finetuneè·¨è¯­è¨€(egs:pl,pt)æµ‹è¯•è¯„ä¼°

`zero-shot-eval` æ²¡æœ‰Finetuneè·¨è¯­è¨€(egs:pl,pt)æµ‹è¯•è¯„ä¼°

**è‡³æ­¤æˆ‘ä»¬å®Œæˆ**

âœˆ-ğŸ±â€ğŸ
